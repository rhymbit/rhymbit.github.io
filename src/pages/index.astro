---
import HomepagePostCard from "@/components/page-components/homepage/homepage-post-card/homepage-post-card.astro";
import SearchPosts from "@/components/search-posts/search-posts.astro";
import BaseLayout from "@/layouts/base-layout.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";

const allPosts = await getCollection("posts");
---

<BaseLayout class="flex flex-col">
  <main
    class="px-2 py-10 w-full h-full grow flex flex-col items-center gap-y-10 overflow-x-clip 2xl:gap-y-20"
  >
    <div>
      <SearchPosts />
    </div>

    <section class="max-w-7xl flex-center flex-col gap-y-5">
      <div>
        <h2 class="font-bold flex-center gap-x-1">
          <Icon name="post" />
          Latest Posts
        </h2>
      </div>
      <section
        class="my-10 grid md:grid-cols-2 lg:grid-cols-3 gap-5 auto-rows-fr"
      >
        {
          allPosts
            .sort((a, b) => {
              const dateA = new Date(a.data.pubDate);
              const dateB = new Date(b.data.pubDate);
              return dateB.getTime() - dateA.getTime();
            })
            .slice(0, 9)
            .map((post) => (
              <div>
                <HomepagePostCard post={post} />
              </div>
            ))
        }
      </section>
    </section>
  </main>
</BaseLayout>
